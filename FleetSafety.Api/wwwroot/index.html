<!DOCTYPE html>
<html lang="en">
<head>
    <title>Fleet Safety System – Altom Transport & Al Warren Oil</title>

    <meta charset="utf-8" />
    <title>Fleet Safety Console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
</head>
<body class="bg-light">
    <div style="background:#1a1a1a; color:white; padding:10px; text-align:center; font-size:14px;">
        Fleet Safety Demo – Built for Altom Transport & Al Warren Oil
    </div>
    
    <div class="container py-4">
        <h1 class="mb-4">Fleet Safety Console</h1>

        <!-- Nav tabs -->
        <ul class="nav nav-tabs mb-3" id="fleetTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="drivers-tab" data-bs-toggle="tab"
                        data-bs-target="#drivers-pane" type="button" role="tab">
                    Drivers
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="vehicles-tab" data-bs-toggle="tab"
                        data-bs-target="#vehicles-pane" type="button" role="tab">
                    Vehicles
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="inspections-tab" data-bs-toggle="tab"
                        data-bs-target="#inspections-pane" type="button" role="tab">
                    Inspections
                </button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- DRIVERS TAB -->
            <div class="tab-pane fade show active" id="drivers-pane" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">Add New Driver</div>
                    <div class="card-body">
                        <form id="driverForm" class="row g-3">
                            <div class="col-md-4">
                                <label for="driverName" class="form-label">Name</label>
                                <input id="driverName" class="form-control" required />
                            </div>
                            <div class="col-md-4">
                                <label for="driverLicense" class="form-label">License Number</label>
                                <input id="driverLicense" class="form-control" required />
                            </div>
                            <div class="col-md-4">
                                <label for="driverHireDate" class="form-label">Hire Date</label>
                                <input id="driverHireDate" type="date" class="form-control" required />
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    Add Driver
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Drivers</div>
                    <div class="card-body">
                        <table class="table table-striped" id="driversTable">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Name</th>
                                    <th>License</th>
                                    <th>Hire Date</th>
                                    <th>Active</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VEHICLES TAB -->
            <div class="tab-pane fade" id="vehicles-pane" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">Add New Vehicle</div>
                    <div class="card-body">
                        <form id="vehicleForm" class="row g-3">
                            <div class="col-md-3">
                                <label for="truckNumber" class="form-label">Truck #</label>
                                <input id="truckNumber" class="form-control" required />
                            </div>
                            <div class="col-md-3">
                                <label for="plateNumber" class="form-label">Plate</label>
                                <input id="plateNumber" class="form-control" required />
                            </div>
                            <div class="col-md-3">
                                <label for="vehicleMake" class="form-label">Make</label>
                                <input id="vehicleMake" class="form-control" required />
                            </div>
                            <div class="col-md-3">
                                <label for="vehicleModel" class="form-label">Model</label>
                                <input id="vehicleModel" class="form-control" required />
                            </div>
                            <div class="col-md-3">
                                <label for="vehicleYear" class="form-label">Year</label>
                                <input id="vehicleYear" type="number" class="form-control" required />
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    Add Vehicle
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Vehicles</div>
                    <div class="card-body">
                        <table class="table table-striped" id="vehiclesTable">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Truck #</th>
                                    <th>Plate</th>
                                    <th>Make</th>
                                    <th>Model</th>
                                    <th>Year</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- INSPECTIONS TAB -->
            <div class="tab-pane fade" id="inspections-pane" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">Add New Inspection</div>
                    <div class="card-body">
                        <form id="inspectionForm" class="row g-3">
                            <div class="col-md-3">
                                <label for="inspectionDriver" class="form-label">Driver</label>
                                <select id="inspectionDriver" class="form-select" required>
                                    <!-- options filled by JS -->
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="inspectionVehicle" class="form-label">Vehicle</label>
                                <select id="inspectionVehicle" class="form-select" required>
                                    <!-- options filled by JS -->
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="inspectionDate" class="form-label">Inspection Date</label>
                                <input id="inspectionDate" type="date" class="form-control" required />
                            </div>
                            <div class="col-md-3">
                                <label for="inspectionLocation" class="form-label">Location</label>
                                <input id="inspectionLocation" class="form-control" required />
                            </div>
                            <div class="col-md-3">
                                <label for="inspectionResult" class="form-label">Result</label>
                                <select id="inspectionResult" class="form-select" required>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="violationCount" class="form-label">Violation Count</label>
                                <input id="violationCount" type="number" class="form-control" value="0" required />
                            </div>
                            <div class="col-md-3 form-check mt-4">
                                <input id="isOutOfService" type="checkbox" class="form-check-input" />
                                <label class="form-check-label" for="isOutOfService">
                                    Out of Service
                                </label>
                            </div>
                            <div class="col-12">
                                <label for="inspectionNotes" class="form-label">Notes</label>
                                <textarea id="inspectionNotes" class="form-control" rows="2"></textarea>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    Add Inspection
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Inspections</div>
                    <div class="card-body">
                        <table class="table table-striped" id="inspectionsTable">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Date</th>
                                    <th>Driver</th>
                                    <th>Vehicle</th>
                                    <th>Location</th>
                                    <th>Result</th>
                                    <th>Violations</th>
                                    <th>Out of Service</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const driversApi = "/api/drivers";
        const vehiclesApi = "/api/vehicles";
        const inspectionsApi = "/api/inspections";

        // ---------- DRIVERS ----------
        async function loadDrivers() {
            const res = await fetch(driversApi);
            const drivers = await res.json();

            // Table
            const tbody = document.querySelector("#driversTable tbody");
            tbody.innerHTML = "";
            drivers.forEach(d => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${d.id}</td>
                    <td>${d.name}</td>
                    <td>${d.licenseNumber}</td>
                    <td>${d.hireDate ? d.hireDate.substring(0,10) : ""}</td>
                    <td>${d.isActive ? "Yes" : "No"}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteDriver(${d.id})">
                            Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Also populate driver dropdown for inspections
            const driverSelect = document.getElementById("inspectionDriver");
            driverSelect.innerHTML = "";
            drivers.forEach(d => {
                const opt = document.createElement("option");
                opt.value = d.id;
                opt.textContent = `${d.name} (#${d.id})`;
                driverSelect.appendChild(opt);
            });
        }

        async function deleteDriver(id) {
            if (!confirm("Delete this driver?")) return;
            await fetch(`${driversApi}/${id}`, { method: "DELETE" });
            await loadDrivers();
        }

        document.getElementById("driverForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const driver = {
                name: document.getElementById("driverName").value,
                licenseNumber: document.getElementById("driverLicense").value,
                hireDate: document.getElementById("driverHireDate").value,
                isActive: true
            };
            await fetch(driversApi, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(driver)
            });
            e.target.reset();
            await loadDrivers();
        });

        // ---------- VEHICLES ----------
        async function loadVehicles() {
            const res = await fetch(vehiclesApi);
            const vehicles = await res.json();

            // Table
            const tbody = document.querySelector("#vehiclesTable tbody");
            tbody.innerHTML = "";
            vehicles.forEach(v => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${v.id}</td>
                    <td>${v.truckNumber}</td>
                    <td>${v.plateNumber}</td>
                    <td>${v.make}</td>
                    <td>${v.model}</td>
                    <td>${v.year}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteVehicle(${v.id})">
                            Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Populate vehicle dropdown for inspections
            const vehicleSelect = document.getElementById("inspectionVehicle");
            vehicleSelect.innerHTML = "";
            vehicles.forEach(v => {
                const opt = document.createElement("option");
                opt.value = v.id;
                opt.textContent = `${v.truckNumber} (${v.plateNumber})`;
                vehicleSelect.appendChild(opt);
            });
        }

        async function deleteVehicle(id) {
            if (!confirm("Delete this vehicle?")) return;
            await fetch(`${vehiclesApi}/${id}`, { method: "DELETE" });
            await loadVehicles();
        }

        document.getElementById("vehicleForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const vehicle = {
                truckNumber: document.getElementById("truckNumber").value,
                plateNumber: document.getElementById("plateNumber").value,
                make: document.getElementById("vehicleMake").value,
                model: document.getElementById("vehicleModel").value,
                year: parseInt(document.getElementById("vehicleYear").value, 10)
            };
            await fetch(vehiclesApi, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(vehicle)
            });
            e.target.reset();
            await loadVehicles();
        });

        // ---------- INSPECTIONS ----------
        async function loadInspections() {
            const res = await fetch(inspectionsApi);
            const inspections = await res.json();

            const tbody = document.querySelector("#inspectionsTable tbody");
            tbody.innerHTML = "";
            inspections.forEach(i => {
                const tr = document.createElement("tr");
                const driverName = i.driver?.name || `#${i.driverId}`;
                const vehicleLabel = i.vehicle
                    ? `${i.vehicle.truckNumber} (${i.vehicle.plateNumber})`
                    : `#${i.vehicleId}`;
                tr.innerHTML = `
                    <td>${i.id}</td>
                    <td>${i.inspectionDate ? i.inspectionDate.substring(0,10) : ""}</td>
                    <td>${driverName}</td>
                    <td>${vehicleLabel}</td>
                    <td>${i.location}</td>
                    <td>${i.result}</td>
                    <td>${i.violationCount}</td>
                    <td>${i.isOutOfService ? "Yes" : "No"}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById("inspectionForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const record = {
        driverId: parseInt(document.getElementById("inspectionDriver").value, 10),
        vehicleId: parseInt(document.getElementById("inspectionVehicle").value, 10),
        inspectionDate: document.getElementById("inspectionDate").value,
        location: document.getElementById("inspectionLocation").value,
        result: document.getElementById("inspectionResult").value,
        violationCount: parseInt(document.getElementById("violationCount").value, 10),
        isOutOfService: document.getElementById("isOutOfService").checked,
        notes: document.getElementById("inspectionNotes").value
    };

    const res = await fetch("/api/inspections", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(record)
    });

    if (!res.ok) {
        console.error("Failed to create inspection", await res.text());
        alert("Failed to create inspection. Check console/logs.");
        return;
    }

    e.target.reset();
    await loadInspections();
});


        // ---------- INITIAL LOAD ----------
        async function init() {
            await loadDrivers();
            await loadVehicles();
            await loadInspections();
        }

        init();
    </script>
    <footer style="margin-top:40px; text-align:center; color:#666; font-size:12px;">
        Custom-built demo for Altom Transport & Al Warren Oil – © 2025
    </footer>
    
</body>
</html>
